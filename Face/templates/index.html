<!DOCTYPE html>
<html>
<head>
    <title>Live Face Detection</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body {
            background-color: black;
            color: white;
            font-family: sans-serif;
            margin: 0;
            padding: 0;
        }

        h1 {
            text-align: center;
        }

        #video-container {
            text-align: center;
            margin: 20px auto;
        }

        #video-feed {
            display: block;
            max-width: 80%;
            height: auto;
        }

        .alert-message {
            color: red;
            display: none;
            text-align: center;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Live Face Detection</h1>

    <div id="video-container">
        <img id="video-feed" src="{{ url_for('video_feed') }}" alt="Live Video Feed">
        <p id="multiple-faces-alert" class="alert-message">Multiple people detected in the frame!</p>
        <p id="no-face-alert" class="alert-message">No face detected!</p>
        <p id="not-looking-alert" class="alert-message">Student is not looking at the screen!</p>
        <p id="camera-closed-alert" class="alert-message">Camera closed due to inactivity.</p>
    </div>

    <script>
        var socket = io.connect('http://' + document.domain + ':' + location.port);
        var noFaceTimer;

        socket.on('connect_error', function(error) {
            console.error('Socket.IO connection error:', error);
            alert('Failed to connect to the server.');
        });

        socket.on('multiple_faces', function(data) {
            document.getElementById('multiple-faces-alert').style.display = data.multiple_faces ? 'block' : 'none';
        });

        socket.on('no_face', function(data) {
            document.getElementById('no-face-alert').style.display = data.no_face ? 'block' : 'none';
            if (data.no_face) {
                if (!noFaceTimer) {
                    noFaceTimer = setTimeout(function() {
                        socket.emit('close_camera');
                        document.getElementById('camera-closed-alert').style.display = 'block';
                        document.getElementById('video-feed').src = "";
                    }, 10000);
                }
            } else {
                clearTimeout(noFaceTimer);
                noFaceTimer = null;
                document.getElementById('camera-closed-alert').style.display = 'none';
            }
        });

        socket.on('not_looking', function(data) {
            document.getElementById('not-looking-alert').style.display = data.not_looking ? 'block' : 'none';
        });

        socket.on('close_camera', function() {
            document.getElementById('camera-closed-alert').style.display = 'block';
            document.getElementById('video-feed').src = "";
        });

    </script>
</body>
</html>